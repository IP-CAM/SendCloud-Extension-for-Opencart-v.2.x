<modification>
    <id>SendCloud OpenCart 2 Extension</id>
    <version>1.2.0</version>
    <vqmver>2.3.0</vqmver>
    <author>Comercia</author>


    <file name="catalog/controller/common/header.php">
        <operation>
            <search position="after"><![CDATA[function index(]]></search>
            <add><![CDATA[comercia\util::load()->controller("common/sendcloud/checkout");]]></add>
        </operation>
    </file>

    <!--admin-->
    <file name="admin/view/template/sale/order_list.twig">
        <operation error="skip">
            <search position="before" index="1"><![CDATA[<button type="submit" id="button-shipping"]]></search>
            <add><![CDATA[
                {% if sendcloud_status %}
                    <button id="button-sendcloud" title = "Orders doorsturen naar SendCloud" class="btn btn-info" form="form-order" formaction="{{sendcloud_url}}" form="form-order" type="submit" onclick="$('#form-order').attr('target', '_self');"  style="padding:4px 10px 3px 9px"><img src="../image/module/sendcloud/sendcloud.svg" style="width:111px; height:26px;"></button>
                {% endif %}
                ]]></add>
        </operation>
    </file>
    <file name="admin/view/template/sale/order_list.tpl">
        <operation error="skip">
            <search position="before" index="1"><![CDATA[<button type="submit" id="button-shipping"]]></search>
            <add><![CDATA[
                <?php if($sendcloud_status) { ?>
                        <button id="button-sendcloud" title = "Orders doorsturen naar SendCloud" class="btn btn-info" form="form-order" formaction="<?php echo $sendcloud_url; ?>" form="form-order" type="submit" onclick="$('#form-order').attr('target', '_self');"  style="padding:4px 10px 3px 9px"><img src="../image/module/sendcloud/sendcloud.svg" style="width:111px; height:26px;"></button>
                <?php } ?>
                ]]></add>
        </operation>
    </file>

    <file name="admin/view/template/sale/order_list.*">
        <operation error="skip">
            <search position="after"><![CDATA[$('input[name^=\'selected\']').on('change', function() {]]></search>
            <add><![CDATA[$('#button-sendcloud').addClass('disabled');]]></add>
        </operation>
        <operation error="skip">
            <search position="after"><![CDATA[if (selected.length) {]]></search>
            <add><![CDATA[$('#button-sendcloud').removeClass('disabled');]]></add>
        </operation>
        <operation error="skip">
            <search position="after"><![CDATA[$('input[name^=\'selected\']:first').trigger('change');]]></search>
            <add>
                <![CDATA[$('#form-order thead input[type=checkbox]').click(function() {
				if($(this).prop("checked")) {$('#button-sendcloud').removeClass('disabled');
				 } else {
				  $('#button-sendcloud').addClass('disabled');
				 }
				});]]>
            </add>
        </operation>
    </file>

    <file name="admin/controller/sale/order.php">
        <operation error="abort">
            <search position="after"><![CDATA[$data['invoice'] = $this->url->link('sale/order/invoice']]></search>
            <add><![CDATA[
                $data['sendcloud_url'] = \comercia\Util::url()->link('module/sendcloud/bulk');
                $data['sendcloud_status'] = \comercia\Util::config()->get('sendcloud_status');
                ]]></add>
        </operation>
    </file>

    <file name="admin/controller/extension/extension/module.php">
        <operation error="skip">
            <search position="before"><![CDATA[$data['extensions'][] = array(]]></search>
            <add position="before"><![CDATA[
			if ($extension == 'sendcloud') {
                if (\comercia\Util::version()->isMaximal('2.3.0.2')) {
                    $data['extensions'][] = array(
                    'name'      => $this->language->get('heading_title'),
                    'module'    => $module_data,
                    'install'   => $this->url->link('extension/extension/module/install', 'token=' . $this->session->data['token'] . '&extension=' . $extension, true),
                    'uninstall' => $this->url->link('extension/extension/module/uninstall', 'token=' . $this->session->data['token'] . '&extension=' . $extension, true),
                    'installed' => in_array($extension, $extensions),
                    'edit'      => $this->url->link('module/' . $extension, 'token=' . $this->session->data['token'], true)
                    );
                    continue;
                 }
                 if (\comercia\Util::version()->isMinimal('3.0')) {
                    $data['extensions'][] = array(
                        'name'      => $this->language->get('extension')->get('heading_title'),
                        'status'    => $this->config->get($extension . '_status') ? $this->language->get('text_enabled') : $this->language->get('text_disabled'),
                        'module'    => $module_data,
                        'install'   => $this->url->link('extension/extension/module/install', 'user_token=' . $this->session->data['user_token'] . '&extension=' . $extension, true),
                        'uninstall' => $this->url->link('extension/extension/module/uninstall', 'user_token=' . $this->session->data['user_token'] . '&extension=' . $extension, true),
                        'installed' => in_array($extension, $extensions),
                        'edit'      => $this->url->link('extension/module/' . $extension, 'user_token=' . $this->session->data['user_token'], true)
                    );
                    continue;
                 }
            }
			]]></add>
        </operation>
    </file>
    <file name="admin/controller/extension/extension/shipping.php">
        <operation error="skip">
            <search position="before"><![CDATA[$data['extensions'][] = array(]]></search>
            <add position="before"><![CDATA[
                if (\comercia\Util::version()->isMinimal('3.0')) {
                    if($extension == 'sendcloud') {
                        $data['extensions'][] = array(
                            'name'       => $this->language->get('extension')->get('heading_title'),
                            'status'     => $this->config->get($extension . '_status') ? $this->language->get('text_enabled') : $this->language->get('text_disabled'),
                            'sort_order' => $this->config->get($extension . '_sort_order'),
                            'install'    => $this->url->link('extension/extension/shipping/install', 'user_token=' . $this->session->data['user_token'] . '&extension=' . $extension, true),
                            'uninstall'  => $this->url->link('extension/extension/shipping/uninstall', 'user_token=' . $this->session->data['user_token'] . '&extension=' . $extension, true),
                            'installed'  => in_array($extension, $extensions),
                            'edit'       => $this->url->link('extension/shipping/' . $extension, 'user_token=' . $this->session->data['user_token'], true)
                        );
                        continue;
                    }
                }

            ]]></add>
        </operation>
    </file>
    <file name="admin/model/setting/extension.php">
        <operation error="skip">
            <search position="after"><![CDATA[$this->db->query("DELETE FROM `" . DB_PREFIX . "setting` WHERE `code` = '" . $this->db->escape($type . '_' . $code) . "'");]]></search>
            <add><![CDATA[
                if (\comercia\Util::version()->isMinimal('3.0')) {
                    if($code == 'sendcloud') {
                        $this->db->query("DELETE FROM `" . DB_PREFIX . "setting` WHERE `code` = '" . $this->db->escape($code) . "'");
                    }
                }]]></add>
        </operation>
    </file>
</modification>
